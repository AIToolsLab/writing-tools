name: Playwright Tests
on:
  # push:
  #   branches: [ main ]
  # pull_request:
  #   branches: [ main ]
  workflow_dispatch:  # Enables manual triggering only
    inputs:
      update-snapshots:
        description: 'Update visual snapshots'
        required: false
        type: boolean
        default: false
defaults:
  run:
    working-directory: frontend
jobs:
  test:
    timeout-minutes: 60
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-node@v4
      with:
        node-version: lts/*
    - name: Install dependencies
      run: npm ci
    - name: Install Playwright Browsers
      run: npx playwright install --with-deps
    - name: Build Frontend
      run: npm run build
    - name: Run Playwright tests
      run: npx playwright test
      continue-on-error: true # Allows subsequent steps to run even if tests fail
      # Playwright will automatically start the frontend via webServer config
      # API calls are mocked in the test file with page.route()

    - name: Upload Playwright report with test results
      uses: actions/upload-artifact@v4
      if: ${{ !cancelled() }}
      with:
        name: playwright-report
        path: |
          frontend/playwright-report/
          frontend/test-results/
        retention-days: 30
    - name: Upload updated snapshots
      if: github.event.inputs.update-snapshots == 'true'
      uses: actions/upload-artifact@v4
      with:
        name: updated-snapshots
        path: frontend/tests/**/*-snapshots/**
        retention-days: 30

